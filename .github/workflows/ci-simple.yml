name: Simple CI - Basic Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:

jobs:
  basic-tests:
    name: Basic Tests - Python ${{ matrix.python-version }} on ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest]
        python-version: ['3.13']

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v5
      with:
        python-version: ${{ matrix.python-version }}
        cache: 'pip'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip setuptools wheel
        pip install -r requirements.txt

    - name: Run basic CI tests only
      run: |
        pytest tests/test_basic_ci.py -v --tb=short
      continue-on-error: false

    - name: Test Summary
      if: always()
      run: |
        echo "### Basic Test Results for Python ${{ matrix.python-version }} on ${{ matrix.os }} ðŸŽ¯" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "Basic tests completed!" >> $GITHUB_STEP_SUMMARY

  structure-tests:
    name: Project Structure & Import Tests
    runs-on: ubuntu-latest
    needs: basic-tests

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.13'
        cache: 'pip'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Test project structure
      run: |
        pytest tests/test_basic_ci.py::TestProjectStructure -v

    - name: Test Python environment
      run: |
        pytest tests/test_basic_ci.py::TestPythonEnvironment -v

    - name: Test core imports
      run: |
        pytest tests/test_basic_ci.py::TestCoreImports -v

  optional-full-tests:
    name: Optional Full Test Suite
    runs-on: ubuntu-latest
    needs: basic-tests
    continue-on-error: true

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.13'
        cache: 'pip'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Generate test data (optional)
      run: |
        python data/generate_data.py || echo "Data generation failed, continuing..."
      continue-on-error: true

    - name: Run all tests (optional)
      run: |
        pytest tests/ -v --tb=short -x
      continue-on-error: true

  summary:
    name: CI Summary
    runs-on: ubuntu-latest
    needs: [basic-tests, structure-tests, optional-full-tests]
    if: always()

    steps:
    - name: Create summary
      run: |
        echo "## ðŸŽ¯ CI Pipeline Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Core Tests (Required):" >> $GITHUB_STEP_SUMMARY
        echo "- **Basic Tests**: ${{ needs.basic-tests.result }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Structure Tests**: ${{ needs.structure-tests.result }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Optional Tests:" >> $GITHUB_STEP_SUMMARY
        echo "- **Full Test Suite**: ${{ needs.optional-full-tests.result }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        # Check if required tests passed
        if [[ "${{ needs.basic-tests.result }}" == "success" ]] && [[ "${{ needs.structure-tests.result }}" == "success" ]]; then
          echo "âœ… **All required tests passed!**" >> $GITHUB_STEP_SUMMARY
        else
          echo "âŒ **Some required tests failed.**" >> $GITHUB_STEP_SUMMARY
        fi
